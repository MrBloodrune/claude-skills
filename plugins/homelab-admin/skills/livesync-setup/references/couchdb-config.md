# CouchDB Configuration Reference

## Complete local.ini

```ini
; /opt/couchdb/etc/local.ini

[couchdb]
single_node=true
uuid = <auto-generated>

[chttpd]
port = 5984
bind_address = 0.0.0.0
authentication_handlers = {chttpd_auth, cookie_authentication_handler}, {chttpd_auth, default_authentication_handler}
require_valid_user = true

[admins]
admin = <password-hash>

[httpd]
enable_cors = true
WWW-Authenticate = Basic realm="couchdb"

[cors]
origins = app://obsidian.md,capacitor://localhost,http://localhost
credentials = true
methods = GET, PUT, POST, HEAD, DELETE
headers = accept, authorization, content-type, origin, referer
max_age = 3600

[couch_httpd_auth]
require_valid_user = true
authentication_redirect = /_utils/session.html
timeout = 600

[log]
level = warning
file = /var/log/couchdb/couchdb.log

[compactions]
_default = [{db_fragmentation, "70%"}, {view_fragmentation, "60%"}]
```

## Systemd Service

```ini
# /etc/systemd/system/couchdb.service
[Unit]
Description=Apache CouchDB
After=network.target

[Service]
Type=simple
User=couchdb
Group=couchdb
ExecStart=/opt/couchdb/bin/couchdb
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

## Database Creation

```bash
# Create vault database
curl -X PUT http://admin:<password>@localhost:5984/rmv0-vault

# Verify
curl http://admin:<password>@localhost:5984/_all_dbs
# ["_replicator","_users","rmv0-vault"]
```

## Useful API Endpoints

```bash
# Server info
curl http://localhost:5984/

# Database info
curl -u admin:<password> http://localhost:5984/rmv0-vault

# Document count
curl -u admin:<password> http://localhost:5984/rmv0-vault/_all_docs?limit=0

# Changes feed (for debugging)
curl -u admin:<password> "http://localhost:5984/rmv0-vault/_changes?limit=10"

# Fauxton UI
# http://localhost:5984/_utils/
```

## Compaction

CouchDB databases grow over time. Compact periodically:

```bash
# Compact database
curl -X POST -u admin:<password> \
  http://localhost:5984/rmv0-vault/_compact

# Compact views
curl -X POST -u admin:<password> \
  http://localhost:5984/rmv0-vault/_view_cleanup
```

## Backup

```bash
# Export database
curl -u admin:<password> \
  "http://localhost:5984/rmv0-vault/_all_docs?include_docs=true" \
  > rmv0-vault-backup.json

# Or use CouchDB replication to another server
```

## Performance Tuning

For larger vaults, adjust:

```ini
[chttpd]
max_http_request_size = 67108864

[couchdb]
max_document_size = 67108864

[httpd]
socket_options = [{recbuf, 262144}, {sndbuf, 262144}]
```
