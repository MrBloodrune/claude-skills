{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": { "type": "grafana", "uid": "-- Grafana --" },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "links": [
    { "title": "Dispatch", "url": "/d/ai-scry-dispatch/", "type": "link", "icon": "bolt" },
    { "title": "Sessions", "url": "/d/ai-scry-sessions/", "type": "link", "icon": "list-ul" },
    { "title": "Prompts", "url": "/d/ai-scry-prompts/", "type": "link", "icon": "comment-alt" }
  ],
  "liveNow": false,
  "panels": [
    {
      "title": "Prompt Browser",
      "type": "table",
      "gridPos": { "h": 14, "w": 24, "x": 0, "y": 0 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "refId": "A",
          "expr": "{service_name=\"ai-scry\"} | json | event_type=\"user_prompt\"",
          "legendFormat": ""
        }
      ],
      "transformations": [
        {
          "id": "extractFields",
          "options": { "source": "Line", "format": "json" }
        },
        {
          "id": "organize",
          "options": {
            "excludeByName": { "Line": true, "labels": true, "tsNs": true, "labelTypes": true, "event_type": true, "agent_id": true, "id": true },
            "renameByName": {
              "session_id": "Session",
              "cwd": "Project",
              "prompt_text": "Prompt",
              "timestamp": "Timestamp"
            }
          }
        }
      ],
      "fieldConfig": {
        "defaults": {},
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "Prompt" },
            "properties": [
              { "id": "custom.width", "value": 600 }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "Session" },
            "properties": [
              { "id": "custom.width", "value": 140 },
              { "id": "links", "value": [
                {
                  "title": "Drill into this session",
                  "url": "/d/ai-scry-prompts/?var-prompt_session=${__data.fields.Session}&from=${__from}&to=${__to}"
                }
              ]}
            ]
          },
          {
            "matcher": { "id": "byName", "options": "Timestamp" },
            "properties": [
              { "id": "custom.hidden", "value": true }
            ]
          }
        ]
      },
      "options": {
        "showHeader": true,
        "sortBy": [{ "displayName": "Time", "desc": true }],
        "footer": { "enablePagination": true }
      }
    },
    {
      "title": "Prompt Detail",
      "type": "logs",
      "gridPos": { "h": 8, "w": 16, "x": 0, "y": 14 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "refId": "A",
          "expr": "{service_name=\"ai-scry\"} | json | session_id=\"$prompt_session\" | event_type=\"user_prompt\"",
          "legendFormat": ""
        }
      ],
      "options": {
        "showTime": true,
        "showLabels": false,
        "showCommonLabels": false,
        "wrapLogMessage": true,
        "prettifyLogMessage": true,
        "enableLogDetails": true,
        "sortOrder": "Descending",
        "dedupStrategy": "none"
      }
    },
    {
      "title": "Prompt Stats",
      "type": "stat",
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 14 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "refId": "Tools",
          "expr": "sum(count_over_time({service_name=\"ai-scry\"} | json | session_id=\"$prompt_session\" | event_type=\"tool_start\" [$__range]))",
          "legendFormat": "Tools"
        },
        {
          "refId": "Agents",
          "expr": "sum(count_over_time({service_name=\"ai-scry\"} | json | session_id=\"$prompt_session\" | event_type=\"agent_complete\" [$__range]))",
          "legendFormat": "Agents"
        },
        {
          "refId": "Errors",
          "expr": "sum(count_over_time({service_name=\"ai-scry\"} | json | session_id=\"$prompt_session\" | event_type=\"tool_error\" [$__range]))",
          "legendFormat": "Errors"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 10 },
              { "color": "red", "value": 50 }
            ]
          }
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "Errors" },
            "properties": [
              { "id": "thresholds", "value": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "red", "value": 1 }] } }
            ]
          }
        ]
      },
      "options": {
        "reduceOptions": { "calcs": ["sum"], "fields": "", "values": false },
        "orientation": "horizontal",
        "textMode": "auto",
        "colorMode": "background"
      }
    },
    {
      "title": "Event Stream",
      "type": "table",
      "gridPos": { "h": 14, "w": 14, "x": 0, "y": 22 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "refId": "A",
          "expr": "{service_name=\"ai-scry\"} | json | session_id=\"$prompt_session\" | event_type=~\"tool_start|tool_end|agent_start|agent_complete\"",
          "legendFormat": ""
        }
      ],
      "transformations": [
        {
          "id": "extractFields",
          "options": { "source": "Line", "format": "json" }
        },
        {
          "id": "organize",
          "options": {
            "excludeByName": { "Line": true, "labels": true, "tsNs": true, "labelTypes": true, "id": true, "session_id": true, "timestamp": true, "contributes_to": true, "transcript_path": true, "agent_transcript_path": true, "task_tags": true, "cwd": true, "tool_use_id": true, "tokens_in": true, "tokens_out": true, "duration_ms": true, "has_error": true, "status": true, "prompt_text": true, "stop_hook_active": true, "task_data": true, "plan_data": true, "spawns_agent_id": true },
            "renameByName": {
              "event_type": "Event",
              "tool_name": "Tool",
              "agent_id": "Agent",
              "agent_label": "Agent Type",
              "agent_type": "Agent Type",
              "tool_params_summary": "Params",
              "tool_response_summary": "Response",
              "task_description": "Task",
              "model": "Model",
              "parent_agent_id": "Parent"
            }
          }
        }
      ],
      "fieldConfig": {
        "defaults": {},
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "Task" },
            "properties": [{ "id": "custom.width", "value": 200 }]
          },
          {
            "matcher": { "id": "byName", "options": "Params" },
            "properties": [{ "id": "custom.width", "value": 200 }]
          }
        ]
      },
      "options": {
        "showHeader": true,
        "sortBy": [{ "displayName": "Time", "desc": false }],
        "footer": { "enablePagination": true }
      }
    },
    {
      "title": "Agent Work",
      "type": "table",
      "gridPos": { "h": 14, "w": 10, "x": 14, "y": 22 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "refId": "A",
          "expr": "{service_name=\"ai-scry\"} | json | session_id=\"$prompt_session\" | event_type=\"agent_complete\"",
          "legendFormat": ""
        }
      ],
      "transformations": [
        {
          "id": "extractFields",
          "options": { "source": "Line", "format": "json" }
        },
        {
          "id": "organize",
          "options": {
            "excludeByName": { "Line": true, "labels": true, "tsNs": true, "labelTypes": true, "id": true, "session_id": true, "event_type": true, "timestamp": true, "contributes_to": true, "transcript_path": true, "agent_transcript_path": true, "task_tags": true, "cwd": true, "tokens_in": true, "tokens_out": true, "duration_ms": true, "status": true },
            "renameByName": {
              "agent_id": "Agent ID",
              "parent_agent_id": "Parent",
              "agent_label": "Type",
              "task_description": "Task",
              "model": "Model"
            }
          }
        }
      ],
      "fieldConfig": {
        "defaults": {},
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "Task" },
            "properties": [{ "id": "custom.width", "value": 200 }]
          }
        ]
      },
      "options": {
        "showHeader": true,
        "sortBy": [{ "displayName": "Time", "desc": true }]
      }
    }
  ],
  "refresh": "",
  "schemaVersion": 39,
  "tags": ["claude-code", "ai-scry", "prompts"],
  "templating": {
    "list": [
      {
        "name": "prompt_id",
        "type": "textbox",
        "current": { "text": "", "value": "" },
        "hide": 2,
        "label": "Prompt ID"
      },
      {
        "name": "prompt_ts",
        "type": "textbox",
        "current": { "text": "", "value": "" },
        "hide": 2,
        "label": "Prompt Timestamp"
      },
      {
        "name": "prompt_session",
        "type": "textbox",
        "current": { "text": "", "value": "" },
        "hide": 2,
        "label": "Prompt Session"
      }
    ]
  },
  "time": { "from": "now-1h", "to": "now" },
  "timepicker": {},
  "timezone": "browser",
  "title": "AI Scry: Prompt Explorer",
  "uid": "ai-scry-prompts",
  "version": 1
}
