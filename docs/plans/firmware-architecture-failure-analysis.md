# Firmware Architecture Visualization — Failure Analysis

**File:** `/home/bloodrune/dev/projects/esp32/dog/firmware-architecture.html`
**Generated by:** technical-visualizer skill
**Analysis date:** 2026-02-16

---

## 1. Visual Issues

### 1.1 Extremely Tiny Text at Desktop Viewport
At full 1440px desktop width, the entire page content appears minuscule. The hero title "MeshstendedModule" is readable but the section cards, labels, and category headers are nearly illegible without zooming. The 15px base font-size combined with a narrow 960px max-width `content-wrap` centered in the remaining space (after the 280px sidebar) results in content that feels like a postage stamp floating in a dark void.

### 1.2 Massive Empty Space
The left sidebar occupies 280px, and the content area has a 960px max-width with 40px horizontal padding. On a 1440px monitor, this leaves approximately 200px of dead space on the right side. The sections themselves are narrow cards swimming in darkness.

### 1.3 Collapsed Sections by Default — Page Looks Like a Skeleton
With all 9 sections collapsed, the entire page is essentially a list of card headers. There is no visual content visible without user interaction. A gold-standard educational guide would show at least the first section expanded or use a different information architecture that doesn't require 9 clicks to see any content.

### 1.4 Color Legend Boxes for Section 1 Are Plain Text
The diagram legend for section 1 (Sensors, MeshstendedModule, LoRa path, WiFi path, HTTP/Telegraf, Infrastructure) renders as a flat text list with small colored squares. The squares are barely visible at normal zoom.

### 1.5 Packet Anatomy Field Labels Truncated
Field names in the byte grid visualization (section 4) are truncated: "Packe", "ground_", "tempera", "mag_hea". The cells are too narrow to display the field names. This defeats the purpose of the visualization.

---

## 2. Missing Components

### 2.1 No Deep-Dive Buttons on Sections 1-7
Only section 8 (Data Pipeline) has a deep-dive button (`Transport details`). The infrastructure spec calls for deep-dive buttons at the bottom of every expanded section to trigger modal popouts with additional detail. Sections 1-7 have modals defined in the HTML (`modal-system-overview`, `modal-memory-map`, `modal-bit-fields`, `modal-state-machine`) but no buttons to trigger them.

### 2.2 No Popovers Anywhere
The skill defines a `popover` pattern concept but the page has zero popover implementations. Hovering over diagram components, memory regions, or table rows produces no contextual popover information. The packet anatomy fields show tooltips on hover but only through CSS-only `.packet-tooltip` elements, not rich popovers.

### 2.3 No Expandable Detail Panels for Tables
The state configuration matrix (section 7) has `cursor: pointer` on rows but clicking produces no visible expansion or detail panel. Same for NVS variables table rows. The cursor styling implies interactivity that does not exist.

### 2.4 No Code Examples
The FreeRTOS reference guide (the gold standard produced by this same skill) includes formatted code blocks with syntax-highlighted API examples (`xTaskCreate`, `xQueueSend`, etc.) and formatted code snippets. The firmware architecture page has zero standalone code examples. The bit field section shows `#define` macros but they are rendered as plain monospace text blocks, not styled code elements.

### 2.5 No Explainer Text Sections with // Style Headers
The FreeRTOS guide uses `// How FreeRTOS Schedules Tasks` style headings (monospace, preceded by `//`) for explanation sections. The firmware page uses generic h4 elements without this pattern, losing the code-documentation feel.

### 2.6 No Badge/Tag System
No visual badges for concepts like "CLIENT-only", "SERVER-only", "PSRAM", "Flash", etc. The tables convey this information but inline badges would improve scannability.

---

## 3. CSS Problems

### 3.1 Duplicate Variable Definitions
The `:root` block defines both the original variables AND a second set of "aliases" (lines 56-72) like `--accent-blue`, `--accent-green-dim`, `--bg-panel`, `--border-active`, `--mono`, `--text`, `--text-bright`. These aliases duplicate existing variables (e.g., `--accent-blue` = `--blue`, `--bg-panel` = `--bg-secondary`). This suggests the file was generated in chunks with inconsistent variable usage.

### 3.2 No Intermediate Breakpoint
Only a single media query at 768px. There is no breakpoint for tablet-sized viewports (768px-1024px). The sidebar occupies 280px of a 768px viewport, leaving only 488px for content — cramped but functional. Between 769px and ~1200px, the sidebar + narrow content area creates an awkward layout.

### 3.3 Inline Styles on Modal Content
Modal body content (lines 4550-4655) uses inline `style` attributes extensively instead of CSS classes: `style="font-family:var(--font-mono);font-size:14px;color:var(--text-primary);margin-bottom:12px;"`. This is inconsistent with the rest of the page which uses well-structured CSS classes.

### 3.4 `.desc-text` Class Used But Not Defined
Modal body paragraphs use `class="desc-text"` but there is no `.desc-text` CSS rule in the stylesheet. These paragraphs get only browser default styling plus inherited body styles.

### 3.5 Truth Table Overflow Not Handled
The state config table (section 7) has 11 columns. On narrower viewports, this table overflows without a horizontal scroll container. The CSS defines `.truth-table { font-size: 10px; }` for mobile but no `overflow-x: auto` wrapper.

---

## 4. Structural Issues

### 4.1 Sections 8 and 9 Use `<div>` Instead of `<article>`
Sections 1-7 use `<article class="section-card">`. Sections 8 (Data Pipeline) and 9 (NVS Variables) use `<div class="section-card">`. This is a semantic inconsistency suggesting the file was generated in separate passes without consistent element selection.

### 4.2 Section 8 Card Header Has Different HTML Structure
Sections 1-7 card headers follow: `card-index` > `card-meta` (containing `card-pattern-label`, `card-title`, `card-summary`) > `card-expand-icon`. Section 8 and 9 headers have a flat structure where `card-pattern-label` is a sibling of a differently-structured title/summary container. The expand icon for sections 8-9 uses `<img>` (SVG chevron) while sections 1-7 use a text `▶` character.

### 4.3 Modals Not Using `<template>` Elements
The infrastructure spec says modal content should use `<template>` elements at the end of body. The actual implementation puts modals as regular `<div>` elements inside `<main>`, meaning their content is always in the DOM and visible to screen readers even when hidden.

### 4.4 Missing ARIA Attributes on Sections 8-9
Sections 1-7 have `aria-expanded="false"` on the card header buttons. Sections 8-9 use `aria-expanded` inconsistently.

---

## 5. Popover Issues

**Popovers are entirely absent.** The page has no popover component at all. There are:
- CSS-only tooltips on packet fields (`.packet-tooltip`) — hover only, no click support
- Modal dialogs triggered by a single deep-dive button
- Nothing that functions as a contextual popover panel

A gold-standard guide would have click-to-expand popovers on:
- Sensor components in the block diagram
- Memory regions in the memory map
- Packet fields showing encoding details
- State machine nodes showing transition rules
- Table rows expanding to show detailed explanations

---

## 6. Visualization Issues

### 6.1 Block Diagram SVG Connections Are Static
The system architecture block diagram (section 1) has an SVG element for connection lines but uses CSS classes `.conn-line` and `.conn-pulse` suggesting animated pulse dots should travel along paths. However, the connections appear to be static in the rendered view, with no visible animated data flow between components.

### 6.2 State Machine Diagram Arrow Tangles
The state machine visualization (section 6) renders 9 state nodes but the SVG connections between them create visual clutter. The known-issues.md documents this as an unresolved problem: "FSM arrow tangles — State machine with >4 nodes produces overlapping SVG arrows." With 9 nodes and many cross-transitions, this is inevitable.

### 6.3 Ring Buffer Animation Has No Auto-Play
The ring buffer visualization (section 8) has Play/Reset buttons but does not auto-play. It starts in an IDLE state showing "FILL: 0%". Contrast with the FreeRTOS guide where animations auto-play when scrolled into view via IntersectionObserver.

### 6.4 Packet Anatomy RFC Diagram Rendered as Monospace Text Block
The RFC-style packet diagram (section 4) is rendered as a `<pre>` block of ASCII art rather than a structured SVG or HTML-grid visualization. The skill's own pattern catalog describes "Packet Anatomy" as an interactive hover/click pattern. The interactive byte grid exists above this, but the RFC text block below it is purely decorative and redundant.

### 6.5 Memory Map Progress Bar Has No Proportional Sizing
The memory map visualization shows regions with colored bars, and there is a proportional bar chart at the bottom, but the stacked regions above don't reflect proportional sizes. The "Framework / Heap ~4.3 MB (53.75%)" region and "Ring Buffer 128 KB (1.56%)" region appear the same visual height despite being orders of magnitude different.

---

## 7. Responsive Issues

### 7.1 Single Breakpoint Only
Only 768px breakpoint exists. No tablet-specific adjustments. Between 769px and 1100px, content is cramped with the sidebar consuming a disproportionate percentage of viewport width.

### 7.2 Tables Not Horizontally Scrollable
Wide tables (State Config with 11 columns, NVS with 6 columns) have no horizontal scroll wrapper. On mobile, cell text wraps awkwardly or gets cut off.

### 7.3 Packet Byte Grid Overflows on Mobile
The 44-cell packet byte grid (section 4) attempts to show all bytes in a single row. On mobile viewports, cells become impossibly narrow, with field names like "Packe" already truncated even at desktop width.

### 7.4 Mobile Hamburger Menu Works But is Minimal
The hamburger navigation trigger exists and correctly hides the sidebar on mobile. The overlay backdrop is defined. This works correctly.

---

## 8. What's Actually Good

### 8.1 Theme Execution
The PCB schematic aesthetic is well-executed: dark navy background, copper trace grid overlay, subtle noise texture, glassmorphic sidebar. The color palette is cohesive and the typography choices (JetBrains Mono + Instrument Sans) are correct per the theme spec.

### 8.2 Content Depth and Accuracy
The technical content is exceptionally detailed and accurate. Byte-level packet breakdowns, memory address ranges, sensor bus addresses, NVS key specifications — all represent genuine firmware documentation quality.

### 8.3 Sidebar Navigation
The collapsible sidebar with category grouping, numbered links, and scroll-synced active state works correctly. The collapse animation is smooth. Category labels are properly styled.

### 8.4 Expandable Card System
The section card expand/collapse with CSS max-height transitions works. Keyboard accessibility (Enter/Space) is implemented. The pattern labels (BLOCK DIAGRAM, MEMORY MAP, etc.) are a nice touch.

### 8.5 Bit Register Interactivity
Section 5 (Header Byte & Flags) has interactive toggleable bit cells that update the decoded value display in real-time. This is the most successful visualization pattern in the page.

### 8.6 State Machine Auto-Play Scenario
Section 6 has an auto-playing scenario that cycles through state transitions with a narrative log. This demonstrates the phase-based setTimeout pattern correctly.

### 8.7 Reduced Motion Support
Both `prefers-reduced-motion` media query and manual toggle button are implemented. The toggle is positioned in the footer.

### 8.8 Mobile Navigation
Hamburger menu, mobile overlay, sidebar slide-in — all functional.

### 8.9 Memory Map Expandable Regions
The click-to-expand memory regions in section 3 work correctly, revealing sub-regions with details.

### 8.10 No JavaScript Errors
The console shows zero errors. All JS executes cleanly.

---

## 9. Gap Analysis — Skill Failures vs Gold Standard

### Critical Gaps

| # | Expected (per SKILL.md / infrastructure.md) | Actual | Severity |
|---|---------------------------------------------|--------|----------|
| 1 | Deep-dive buttons on every section | Only 1 button on section 8 | HIGH |
| 2 | Modals triggered by deep-dive buttons | 5 modals exist but 4 are unreachable (no trigger buttons) | HIGH |
| 3 | `<template>` elements for modal content | Modals are plain `<div>` in the DOM | MEDIUM |
| 4 | `<article>` elements for all section cards | Sections 8-9 use `<div>` | LOW |
| 5 | Code examples with styled code blocks | Zero code examples (only inline monospace) | MEDIUM |
| 6 | `// Comment-style` section headings | Not used anywhere | LOW |
| 7 | Consistent card header HTML structure | Sections 8-9 differ from 1-7 | MEDIUM |
| 8 | Interactive popovers on diagram components | Zero popovers | HIGH |
| 9 | Animated connection pulses on block diagrams | Connections appear static | MEDIUM |
| 10 | IntersectionObserver auto-play for animations | Ring buffer starts as IDLE, no auto-play | MEDIUM |
| 11 | Proportional memory map bars | Regions have equal height regardless of size | LOW |
| 12 | Multiple pill-button groupings per section (like `[ Stack Sizing ] [ Priority Guide ]`) | Zero pill-button groupings | HIGH |
| 13 | Horizontal scroll containers for wide tables | Tables can overflow on small screens | MEDIUM |
| 14 | `.desc-text` class CSS definition | Used in HTML but undefined in CSS | LOW |

### Content Structure Gaps

The gold standard (FreeRTOS guide) follows a strict per-section pattern:
1. Explanation prose with `//` headers
2. Visual state/flow diagram
3. Animation with play/pause/reset controls
4. Code example block
5. Pill-button group for deep-dive modals

The firmware architecture page follows an inconsistent pattern:
1. Some prose (good)
2. Custom visualization (good but varied quality)
3. Data tables (good but not interactive)
4. Deep-dive button (only on section 8)
5. Missing: code examples, pill buttons, // headers

### Architecture Assessment

The page was clearly generated in multiple passes. Evidence:
- CSS has duplicate variable sets (original + aliases)
- Sections 1-7 vs 8-9 have different HTML element types and structure
- Only 1 of 5 modals has a trigger button
- Inline styles on modals vs CSS classes elsewhere
- The content quality is high but the component integration is incomplete

The skill successfully generated the theme, layout, sidebar, and content. It failed to consistently apply the interaction patterns (popovers, deep-dive buttons, code examples, pill buttons) that make the FreeRTOS reference guide feel like a polished educational product rather than a data dump with a pretty skin.
